<h2>クライアントの実行結果</h2>
<pre>
$ telnet localhost 50000
Trying ::1...
telnet: connect to address ::1: Connection refused
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
> list
aaa.txt
bbb.txt
ccc.txt
ddd.txt
> type aaa.txt
This file is aaa.txt
Can you read this file?
Thank you for reading this file.
> type bbb.txt
This file is bbb.txt
Can you read this file?
Thank you for reading this file.
> hello
Invalid command
> exit
Connection closed by foreign host.
</pre>
<h2>ソースコード</h2>
<pre>
#include "mynet.h"

#define PORT 50000  /* ポート番号 */
#define BUFSIZE 100 /* バッファサイズ */

int main(int argc, char *argv[]) {
    int sock_listen, sock_accepted;
    char client_message[BUFSIZE], output_text[BUFSIZE];
    int strsize;
    int port_number = PORT;
    FILE *fp;

    if (argc == 2) {
        port_number = atoi(argv[1]);
    }

    sock_listen = init_tcpserver(port_number, 5);

    /* クライアントの接続を受け付ける */
    sock_accepted = accept(sock_listen, NULL, NULL);
    close(sock_listen);

    do {
        // ">" をクライアントに送信
        if (send(sock_accepted, "> ", 3, 0) == -1) {
            exit_errmesg("send()");
        }

        /* 文字列をクライアントから受信する */
        if ((strsize = recv(sock_accepted, client_message, BUFSIZE, 0)) == -1) {
            exit_errmesg("recv()");
        }
        client_message[strsize - 2] = '\0';

        // listコマンドの場合
        if (strcmp(client_message, "list") == 0) {
            if ((fp = popen("ls ~/work", "r")) == NULL) {
                exit_errmesg("popen()");
            }

            while (fgets(output_text, BUFSIZE, fp) != NULL) {
                send(sock_accepted, output_text, strlen(output_text), 0);
            }

            pclose(fp);

        }
        //typeコマンドの場合
        else if (strncmp(client_message, "type", 4) == 0) {
            char cmd[BUFSIZE];
            char *file_name = client_message + 5;
            snprintf(cmd, BUFSIZE, "cat ~/work/%s", file_name);

            if ((fp = popen(cmd, "r")) == NULL) {
                exit_errmesg("popen()");
            }

            while (fgets(output_text, BUFSIZE, fp) != NULL) {
                send(sock_accepted, output_text, strlen(output_text), 0);
            }

            pclose(fp);
        }
        //exitコマンドの場合
        else if (strcmp(client_message, "exit") == 0) {
            break;
        }
        //それ以外のコマンドの場合
        else {
            if (send(sock_accepted, "Invalid command\n", 17, 0) == -1) {
                exit_errmesg("send()");
            }
        }
    } while (1); /* 繰り返す */

    close(sock_accepted);

    exit(EXIT_SUCCESS);
}

</pre>